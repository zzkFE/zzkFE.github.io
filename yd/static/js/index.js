/*! 
 tshirt 
 发布时间：2016-08-21 14:08:24 
 游订公司
*/
!function(exports){"use strict";function a(){this.current={},this._tasks={},this._queue=[],this._placeholder={placeholder:!0},this._marker={marker:!0},this._options={},this._running=!1,this._success={}}var b=require("../grunt");exports.Task=a,exports.create=function(){return new a},a.prototype._throwIfRunning=function(a){if(this._running||!this._options.error)throw a;this._options.error.call({name:null},a)},a.prototype.registerTask=function(a,b,c){null==c&&(c=b,b=null);var d;return"function"!=typeof c?(d=this.parseArgs([c]),c=this.run.bind(this,c),c.alias=!0,b||(b='Alias for "'+d.join('", "')+'" task'+(1===d.length?"":"s")+".")):b||(b="Custom task."),this._tasks[a]={name:a,info:b,fn:c},this},a.prototype.isTaskAlias=function(a){return!!this._tasks[a].fn.alias},a.prototype.exists=function(a){return a in this._tasks},a.prototype.renameTask=function(a,b){if(!this._tasks[a])throw new Error('Cannot rename missing "'+a+'" task.');return this._tasks[b]=this._tasks[a],this._tasks[b].name=b,delete this._tasks[a],this},a.prototype.parseArgs=function(a){return Array.isArray(a[0])?a[0]:[].slice.call(a)},a.prototype.splitArgs=function(a){return a?(a=a.replace(/\\\\/g,"￿").replace(/\\:/g,"￾"),a.split(":").map(function(a){return a.replace(/\uFFFE/g,":").replace(/\uFFFF/g,"\\")})):[]},a.prototype._taskPlusArgs=function(a){var b,c=this.splitArgs(a),d=c.length;do b=this._tasks[c.slice(0,d).join(":")];while(!b&&--d>0);var e=c.slice(d),f={};return e.forEach(function(a){f[a]=!0}),{task:b,nameArgs:a,args:e,flags:f}},a.prototype._push=function(a){var b=this._queue.indexOf(this._placeholder);b===-1?this._queue=this._queue.concat(a):[].splice.apply(this._queue,[b,0].concat(a))},a.prototype.run=function(){var a=this.parseArgs(arguments).map(this._taskPlusArgs,this),b=a.filter(function(a){return!a.task});return b.length>0?(this._throwIfRunning(new Error('Task "'+b[0].nameArgs+'" not found.')),this):(this._push(a),this)},a.prototype.mark=function(){return this._push(this._marker),this},a.prototype.runTaskFn=function(a,c,d,e){var f=!1,g=function(b){var c=null;b===!1?c=new Error('Task "'+a.nameArgs+'" failed.'):b instanceof Error||"[object Error]"==={}.toString.call(b)?(c=b,b=!1):b=!0,this.current={},this._success[a.nameArgs]=b,!b&&this._options.error&&this._options.error.call({name:a.name,nameArgs:a.nameArgs},c),e?process.nextTick(function(){d(c,b)}):d(c,b)}.bind(this);a.async=function(){return f=!0,b.util._.once(function(a){setTimeout(function(){g(a)},1)})},this.current=a;try{var h=c.call(a);f||g(h)}catch(a){g(a)}},a.prototype.start=function(a){if(a||(a={}),this._running)return!1;var b=function(){var c;do c=this._queue.shift();while(c===this._placeholder||c===this._marker);if(!c)return this._running=!1,void(this._options.done&&this._options.done());this._queue.unshift(this._placeholder);var d={nameArgs:c.nameArgs,name:c.task.name,args:c.args,flags:c.flags};this.runTaskFn(d,function(){return c.task.fn.apply(this,this.args)},b,!!a.asyncDone)}.bind(this);this._running=!0,b()},a.prototype.clearQueue=function(a){return a||(a={}),a.untilMarker?this._queue.splice(0,this._queue.indexOf(this._marker)+1):this._queue=[],this},a.prototype.requires=function(){this.parseArgs(arguments).forEach(function(a){var b=this._success[a];if(!b)throw new Error('Required task "'+a+'" '+(b===!1?"failed":"must be run first")+".")}.bind(this))},a.prototype.options=function(a){Object.keys(a).forEach(function(b){this._options[b]=a[b]}.bind(this))}}("object"==typeof exports&&exports||this);